var Q;(function(t){var e;function i(t,i){e.call(this,t,i);this.errorsFor(t).each(function(e,i){if($(t).hasClass("error"))$(i).removeClass("checked");$(i).attr("title",$(i).text())})}function r(){var t=$.validator;t=t.prototype;e=t.showLabel;t.showLabel=i;t.oldfocusInvalid=t.focusInvalid;t.focusInvalid=function(){if(this.settings.abortHandler)this.settings.abortHandler(this);this.oldfocusInvalid.call(this)};t.oldstopRequest=t.focusInvalid;t.stopRequest=function(t,e){var i=this.formSubmitted;this.oldfocusInvalid.call(this,[t,e]);if(!e&&this.pendingRequest==0&&i&&this.settings.abortHandler){this.settings.abortHandler(this)}};t.resetAll=function(){this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)}}function n(t){t.settings.abortHandler=null;t.settings.submitHandler=function(){return false}}t.validatorAbortHandler=n;function a(e){var i=t.baseValidateOptions();delete i.showErrors;return t.extend(t.extend(i,{meta:"v",errorPlacement:function(t,e){var i=null;var r=e.attr("data-vx-id");if(r){i=$("#"+r);if(!i.length)i=null;else i=i[0]}if(i==null){i=e.parents("div.field");if(i.length){var n=$("div.vx",i[0]);if(n.length)i=n[0]}else i=e.parent()}t.appendTo(i)},submitHandler:function(){return false},invalidHandler:function(e,i){t.notifyError(t.text("Validation.InvalidFormMessage"));$(i.errorList.map(function(t){return t.element})).closest(".category.collapsed").children(".category-title").each(function(t,e){$(e).click();return true});if(i.errorList.length){var r=i.errorList[0].element;if(r){var n=$(r).closest(".tab-pane");if(!n.hasClass("active")&&n.parent().hasClass("tab-content")){var a=n.attr("id");if(a){$('a[href="#'+a+'"]').click()}}if($.fn.tooltip){var o=$(r);if(o.hasClass("select2-offscreen")&&r.id){o=$("#s2id_"+r.id)}$.fn.tooltip&&o.tooltip({title:i.errorList[0].message,trigger:"manual"}).tooltip("show");window.setTimeout(function(){o.tooltip("destroy")},1500)}}}},success:function(t){t.addClass("checked")}}),e)}t.validateOptions=a;if($.validator)r();else $(function(){$.validator&&r()})})(Q||(Q={}));var Serenity;(function(t){var e;(function(t){function e(t,e,i){var r=t.validate();var n=r.settings;if(n.abortHandler){return false}if(e!=null&&e()===false){return false}n["abortHandler"]=Q.validatorAbortHandler;n["submitHandler"]=function(){if(i!=null){i()}return false};t.trigger("submit");return true}t.asyncSubmit=e;function i(t,e,i){var r=t.validate();var n=r.settings;if(n.abortHandler!=null){return false}if(e!=null&&e()===false){return false}if(!r.form()){return false}if(i!=null){i()}return true}t.submit=i;function r(t){var e=t.closest("form");if(e.length===0){return null}return e.data("validator")}t.getValidator=r})(e=t.ValidationHelper||(t.ValidationHelper={}));var i;(function(t){t.addValidationRule=Q.addValidationRule;t.removeValidationRule=Q.removeValidationRule;function e(t,e){return t.element(e.element[0])}t.validateElement=e})(i=t.VX||(t.VX={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.initValidator();r.initTabs();r.initToolbar();return r}i.prototype.destroy=function(){if(this.tabs){this.tabs.tabs("destroy");this.tabs=null}if(this.toolbar){this.toolbar.destroy();this.toolbar=null}if(this.validator){this.byId("Form").remove();this.validator=null}e.prototype.destroy.call(this)};i.prototype.arrange=function(){this.element.find(".require-layout").filter(":visible").each(function(t,e){$(e).triggerHandler("layout")})};i.prototype.getToolbarButtons=function(){return[]};i.prototype.getValidatorOptions=function(){return{}};i.prototype.initTabs=function(){var t=this.byId("Tabs");if(t.length===0){return}this.tabs=t.tabs({})};i.prototype.initToolbar=function(){var e=this.byId("Toolbar");if(e.length===0){return}var i={buttons:this.getToolbarButtons()};this.toolbar=new t.Toolbar(e,i)};i.prototype.initValidator=function(){var t=this.byId("Form");if(t.length>0){var e=this.getValidatorOptions();this.validator=t.validate(Q.validateOptions(e))}};i.prototype.resetValidation=function(){if(this.validator){this.validator.resetAll()}};i.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};return i}(t.TemplatedWidget);t.TemplatedPanel=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(t){function e(t,e,i){if(!t)return;var r=n(t);if(!r)return;var a=r[e];if(a==null){return}if(i&&a===t.tabs("option","active")){t.tabs("option","active",0)}t.tabs(i?"disable":"enable",a)}t.setDisabled=e;function i(t,e,i){if(!t)return;var r=n(t);if(!r)return;var a=r[e];if(a==null){return}if(!i&&a===t.tabs("option","active")){t.tabs("option","active",0)}t.children("ul").children("li").eq(a).toggle(i)}t.toggle=i;function r(t){var e=t.children("ul").children("li").eq(t.tabs("option","active")).children("a").attr("href").toString();var i="_Tab";var r=e.lastIndexOf(i);if(r>=0){e=e.substr(r+i.length)}return e}t.activeTabKey=r;function n(t){var e=t.data("indexByKey");if(!e){e={};t.children("ul").children("li").children("a").each(function(t,i){var r=i.getAttribute("href").toString();var n="_Tab";var a=r.lastIndexOf(n);if(a>=0){r=r.substr(a+n.length)}e[r]=t});t.data("indexByKey",e)}return e}t.indexByKey=n;function a(t,e){var i=n(t);if(!i)return;var r=i[e];if(r==null){return}if(r!==t.tabs("option","active")){t.tabs("option","active",r)}}t.selectTab=a})(e=t.TabsExtensions||(t.TabsExtensions={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e;(function(e){function i(e,i){if(i==null){return}var r=Q.getInstanceType(e);if(r===Object){return}var n=r.__propByName;var a=r.__fieldByName;if(n==null){var o=Q.getMembers(r,16);var s=o.filter(function(e){return!!e.setter&&((e.attr||[]).filter(function(e){return Q.isInstanceOfType(e,t.OptionAttribute)}).length>0||(e.attr||[]).filter(function(t){return Q.isInstanceOfType(t,System.ComponentModel.DisplayNameAttribute)}).length>0)});n={};for(var l=0,d=s;l<d.length;l++){var u=d[l];n[t.ReflectionUtils.makeCamelCase(u.name)]=u}r.__propByName=n}if(a==null){var f=Q.getMembers(r,4);var c=f.filter(function(e){return(e.attr||[]).filter(function(e){return Q.isInstanceOfType(e,t.OptionAttribute)}).length>0||(e.attr||[]).filter(function(t){return Q.isInstanceOfType(t,System.ComponentModel.DisplayNameAttribute)}).length>0});a={};for(var p=0;p<c.length;p++){var h=c[p];a[t.ReflectionUtils.makeCamelCase(h.name)]=h}r.__fieldByName=a}var v=Object.keys(i);for(var y=0,m=v;y<m.length;y++){var g=m[y];var b=i[g];var C=t.ReflectionUtils.makeCamelCase(g);var T=n[C]||n[g];if(T!=null){var $=e[T.setter];$&&$.call(e,b)}else{var x=a[C]||a[g];x&&(e[x.name]=b)}}}e.set=i})(e=t.ReflectionOptionsSetter||(t.ReflectionOptionsSetter={}))})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.categoryLinkClick=function(t){t.preventDefault();var e=$("a[name="+t.target.getAttribute("href").toString().substr(1)+"]");if(e.closest(".category").hasClass("collapsed"))e.closest(".category").children(".category-title").click();var i=function(){e.fadeTo(100,.5,function(){e.fadeTo(100,1,function(){})})};var r=e.closest(".category");if(r.closest(":scrollable(both)").length===0)i();else{r.scrollintoview({duration:"fast",direction:"y",complete:i})}};if(i.mode==null)i.mode=1;t.addClass("s-PropertyGrid");r.editors=[];var n=r.options.items||[];r.items=[];var a=Q.any(n,function(t){return!Q.isEmptyOrNull(t.tab)});if(a){var o=n.filter(function(t){return Q.isEmptyOrNull(t.tab)});if(o.length>0){r.createItems(r.element,o);$("<div class='pad'></div>").appendTo(r.element)}var s=n.filter(function(t){return!Q.isEmptyOrNull(t.tab)});var l=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(r.element);var d=$("<div class='tab-content property-panes'></div>").appendTo(r.element);var u=0;var f=0;while(f<s.length){var c={$:Q.trimToEmpty(s[f].tab)};var p=[];var h=f;do{p.push(s[h])}while(++h<s.length&&Q.trimToEmpty(s[h].tab)===c.$);f=h;var v=$("<li><a data-toggle='tab' role='tab'></a></li>").appendTo(l);if(u===0){v.addClass("active")}var y=r.uniqueName+"_Tab"+u;v.children("a").attr("href","#"+y).text(r.determineText(c.$,function(t){return t+"Tabs."+this.tab.$}.bind({tab:c})));var m=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(d);if(u===0){m.addClass("in active")}m.attr("id",y);r.createItems(m,p);u++}}else{r.createItems(r.element,n)}r.updateInterface();return r}r=i;i.prototype.destroy=function(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++){this.editors[e].destroy()}this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove();t.Widget.prototype.destroy.call(this)};i.prototype.createItems=function(t,e){var i={};var r=t;var n=this.options.useCategories!==false&&Q.any(e,function(t){return!Q.isEmptyOrNull(t.category)});if(n){var a=$("<div/>").addClass("category-links");i=this.createCategoryLinks(a,e);if(Object.keys(i).length>1){a.appendTo(t)}else{a.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}}r=$("<div/>").addClass("categories").appendTo(t);var o;if(n){o=r}else{o=$("<div/>").addClass("category").appendTo(r)}var s=null;for(var l=0;l<e.length;l++){var d=e[l];var u=d.category;if(u==null){u=Q.coalesce(this.options.defaultCategory,"")}if(n&&s!==u){var f=this.createCategoryDiv(r,i,u,d.collapsible!==true?null:Q.coalesce(d.collapsed,false));if(s==null){f.addClass("first-category")}s=u;o=f}var c=this.createField(o,d);this.items.push(d);this.editors.push(c)}};i.prototype.createCategoryDiv=function(t,e,i,r){var n=$("<div/>").addClass("category").appendTo(t);var a=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(t){return t+"Categories."+i})).attr("name",this.options.idPrefix+"Category"+e[i].toString())).appendTo(n);if(r!=null){n.addClass(r===true?"collapsible collapsed":"collapsible");var o=$("<i/>").addClass(r===true?"fa fa-plus":"fa fa-minus").appendTo(a);a.click(function(t){n.toggleClass("collapsed");o.toggleClass("fa-plus").toggleClass("fa-minus")})}return n};i.prototype.determineText=function(t,e){if(t!=null&&!Q.startsWith(t,"`")){var i=Q.tryGetText(t);if(i!=null){return i}}if(t!=null&&Q.startsWith(t,"`")){t=t.substr(1)}if(!Q.isEmptyOrNull(this.options.localTextPrefix)){var r=Q.tryGetText(e(this.options.localTextPrefix));if(r!=null){return r}}return t};i.prototype.createField=function(e,i){var n=$("<div/>").addClass("field").addClass(i.name).data("PropertyItem",i).appendTo(e);if(!Q.isEmptyOrNull(i.cssClass)){n.addClass(i.cssClass)}if(!Q.isEmptyOrNull(i.formCssClass)){n.addClass(i.formCssClass);if(i.formCssClass.indexOf("line-break-")>=0){var a=i.formCssClass.split(String.fromCharCode(32));if(a.indexOf("line-break-xs")>=0){$("<div class='line-break' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-sm")>=0){$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-md")>=0){$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(n)}else if(a.indexOf("line-break-lg")>=0){$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(n)}}}var o=this.options.idPrefix+i.name;var s=this.determineText(i.title,function(t){return t+i.name});var l=this.determineText(i.hint,function(t){return t+i.name+"_Hint"});var d=this.determineText(i.placeholder,function(t){return t+i.name+"_Placeholder"});if(l==null){l=Q.coalesce(s,"")}var u=$("<label/>").addClass("caption").attr("for",o).attr("title",l).html(Q.coalesce(s,"")).appendTo(n);if(!Q.isEmptyOrNull(i.labelWidth)){if(i.labelWidth==="0"){u.hide()}else{u.css("width",i.labelWidth)}}if(i.required===true){$("<sup>*</sup>").attr("title",Q.text("Controls.PropertyGrid.RequiredHint")).prependTo(u)}var f=t.EditorTypeRegistry.get(Q.coalesce(i.editorType,"String"));var c=Q.getAttributes(f,t.ElementAttribute,true);var p=c.length>0?c[0].value:"<input/>";var h=t.Widget.elementFor(f).addClass("editor").attr("id",o).appendTo(n);if(h.is(":input")){h.attr("name",Q.coalesce(i.name,""))}if(!Q.isEmptyOrNull(d)){h.attr("placeholder",d)}var v=i.editorParams;var y=null;var m=Q.getAttributes(f,t.OptionsTypeAttribute,true);if(m!=null&&m.length>0){y=m[0].optionsType}var g;if(y!=null){v=Q.extend(new y,i.editorParams);g=new f(h,v)}else{v=Q.extend(new Object,i.editorParams);g=new f(h,v)}g.initialize();if(Q.getTypeName(g)=="BooleanEditor"&&(i.editorParams==null||!!!i.editorParams["labelFor"])){u.removeAttr("for")}if(Q.getTypeName(g)=="RadioButtonEditor"&&(i.editorParams==null||!!!i.editorParams["labelFor"])){u.removeAttr("for")}if(i.maxLength!=null){r.setMaxLength(g,i.maxLength)}if(i.editorParams!=null){t.ReflectionOptionsSetter.set(g,i.editorParams)}$("<div/>").addClass("vx").appendTo(n);$("<div/>").addClass("clear").appendTo(n);return g};i.prototype.getCategoryOrder=function(t){var e=0;var i={};var r=Q.trimToNull(this.options.categoryOrder);if(r!=null){var n=r.split(";");for(var a=0,o=n;a<o.length;a++){var s=o[a];var l=Q.trimToNull(s);if(l==null){continue}if(i[l]!=null){continue}i[l]=e++}}for(var d=0,u=t;d<u.length;d++){var f=u[d];var c=f.category;if(c==null){c=Q.coalesce(this.options.defaultCategory,"")}if(i[c]==null){i[c]=e++}}return i};i.prototype.createCategoryLinks=function(t,e){var i=0;var r={};var n={};for(var a=0,o=e;a<o.length;a++){var s=o[a];var l=s.name;var d=s.category;if(d==null){d=Q.coalesce(this.options.defaultCategory,"")}n[l]=d;r[s.name]=i++}var u=this;var f=this.getCategoryOrder(e);e.sort(function(t,e){var i=0;var a=n[t.name];var o=n[e.name];if(a!=o){var s=f[a];var l=f[o];if(s!=null&&l!=null){i=s-l}else if(s!=null){i=-1}else if(l!=null){i=1}}if(i===0){i=Q.Culture.stringCompare(a,o)}if(i===0){i=r[t.name]<r[e.name]?-1:r[t.name]>r[e.name]?1:0}return i});var c={};for(var p=0;p<e.length;p++){var h=e[p];var v={$:n[h.name]};if(c[v.$]==null){var y=Object.keys(c).length+1;c[v.$]=y;if(y>1){$("<span/>").addClass("separator").text("|").prependTo(t)}$("<a/>").addClass("category-link").text(this.determineText(v.$,function(t){return t+"Categories."+this.category.$}.bind({category:v}))).attr("tabindex","-1").attr("href","#"+this.options.idPrefix+"Category"+y.toString()).click(this.categoryLinkClick).prependTo(t)}}$("<div/>").addClass("clear").appendTo(t);return c};i.prototype.get_editors=function(){return this.editors};i.prototype.get_items=function(){return this.items};i.prototype.get_idPrefix=function(){return this.options.idPrefix};i.prototype.get_mode=function(){return this.options.mode};i.prototype.set_mode=function(t){if(this.options.mode!==t){this.options.mode=t;this.updateInterface()}};i.loadEditorValue=function(t,e,i){};i.saveEditorValue=function(e,i,r){t.EditorUtils.saveValue(e,i,r)};i.setReadOnly=function(e,i){t.EditorUtils.setReadOnly(e,i)};i.setReadonly=function(e,i){return t.EditorUtils.setReadonly(e,i)};i.setRequired=function(e,i){t.EditorUtils.setRequired(e,i)};i.setMaxLength=function(t,e){if(t.element.is(":input")){if(e>0){t.element.attr("maxlength",e)}else{t.element.removeAttr("maxlength")}}};i.prototype.load=function(e){for(var i=0;i<this.editors.length;i++){var r=this.items[i];var n=this.editors[i];if(!!(this.get_mode()===1&&r.defaultValue!=null)&&typeof e[r.name]==="undefined"){e[r.name]=r.defaultValue}t.EditorUtils.loadValue(n,r,e)}};i.prototype.save=function(e){if(e==null)e=Object.create(null);for(var i=0;i<this.editors.length;i++){var r=this.items[i];if(r.oneWay!==true&&this.canModifyItem(r)){var n=this.editors[i];t.EditorUtils.saveValue(n,r,e)}}return e};Object.defineProperty(i.prototype,"value",{get:function(){return this.save()},set:function(t){if(t==null)t=Object.create(null);this.load(t)},enumerable:true,configurable:true});i.prototype.canModifyItem=function(t){if(this.get_mode()===1){if(t.insertable===false){return false}if(t.insertPermission==null){return true}return Q.Authorization.hasPermission(t.insertPermission)}else if(this.get_mode()===2){if(t.updatable===false){return false}if(t.updatePermission==null){return true}return Q.Authorization.hasPermission(t.updatePermission)}return true};i.prototype.updateInterface=function(){for(var e=0;e<this.editors.length;e++){var i=this.items[e];var r=this.editors[e];var n=i.readOnly===true||!this.canModifyItem(i);t.EditorUtils.setReadOnly(r,n);t.EditorUtils.setRequired(r,!n&&!!i.required&&i.editorType!=="Boolean");if(i.visible===false||i.readPermission!=null||i.insertPermission!=null||i.updatePermission!=null||i.hideOnInsert===true||i.hideOnUpdate===true){var a=i.readPermission!=null&&!Q.Authorization.hasPermission(i.readPermission)||i.visible===false||this.get_mode()===1&&i.hideOnInsert===true||this.get_mode()===2&&i.hideOnUpdate===true;r.getGridField().toggle(!a)}}};i.prototype.enumerateItems=function(t){for(var e=0;e<this.editors.length;e++){var i=this.items[e];var r=this.editors[e];t(i,r)}};var r;i=r=__decorate([t.Decorators.registerClass("PropertyGrid")],i);return i}(t.Widget);t.PropertyGrid=e})(Serenity||(Serenity={}));var Serenity;(function(t){var e=function(e){__extends(i,e);function i(t,i){var r=e.call(this,t,i)||this;r.initPropertyGrid();r.loadInitialEntity();return r}i.prototype.destroy=function(){if(this.propertyGrid){this.propertyGrid.destroy();this.propertyGrid=null}if(this.validator){this.byId("Form").remove();this.validator=null}e.prototype.destroy.call(this)};i.prototype.initPropertyGrid=function(){var e=this.byId("PropertyGrid");if(e.length<=0){return}var i=this.getPropertyGridOptions();this.propertyGrid=new t.PropertyGrid(e,i).init(null);if(this.element.closest(".ui-Panel").hasClass("s-Flexify")){this.propertyGrid.element.children(".categories").flexHeightOnly(1)}};i.prototype.loadInitialEntity=function(){if(this.propertyGrid){this.propertyGrid.load(new Object)}};i.prototype.getFormKey=function(){var e=Q.getAttributes(Q.getInstanceType(this),t.FormKeyAttribute,true);if(e.length>=1){return e[0].value}var i=Q.getTypeFullName(Q.getInstanceType(this));var r=i.indexOf(".");if(r>=0){i=i.substring(r+1)}if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-6)}else if(Q.endsWith(i,"Panel")){i=i.substr(0,i.length-5)}return i};i.prototype.getPropertyGridOptions=function(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:false,localTextPrefix:"Forms."+this.getFormKey()+"."}};i.prototype.getPropertyItems=function(){var t=this.getFormKey();return Q.getForm(t)};i.prototype.getSaveEntity=function(){var t=new Object;if(this.propertyGrid){this.propertyGrid.save(t)}return t};i.prototype.get_entity=function(){return this._entity};i.prototype.get_entityId=function(){return this._entityId};i.prototype.set_entity=function(t){this._entity=Q.coalesce(t,new Object)};i.prototype.set_entityId=function(t){this._entityId=t};i.prototype.validateBeforeSave=function(){return this.validator.form()};i=__decorate([t.Decorators.registerClass("Serenity.PropertyPanel")],i);return i}(t.TemplatedPanel);t.PropertyPanel=e})(Serenity||(Serenity={}));var Serenity;(function(t){function e(){if(typeof Vue==="undefined")return false;Vue.component("editor",{props:{type:{type:String,required:true},id:{type:String,required:false},name:{type:String,required:false},placeholder:{type:String,required:false},value:{required:false},options:{required:false},maxLength:{required:false}},render:function(e){var i=t.EditorTypeRegistry.get(this.type);var r=Q.getAttributes(i,t.ElementAttribute,true);var n=r.length>0?r[0].value:"<input/>";var a={};var o=$(n)[0];var s=o.attributes;for(var l=0;l<s.length;l++){var d=s.item(l);a[d.name]=d.value}if(this.id!=null)a.id=this.id;if(this.name!=null)a.name=this.name;if(this.placeholder!=null)a.placeholder=this.placeholder;var u=this.options;var f=null;var c=this;var p=e(o.tagName,{domProps:a});this.$editorType=i;return p},watch:{value:function(e){t.EditorUtils.setValue(this.$widget,e)}},mounted:function(){var e=this;this.$widget=new this.$editorType($(this.$el),this.options);this.$widget.initialize();if(this.maxLength){t.PropertyGrid.$setMaxLength(this.$widget,this.maxLength)}if(this.options)t.ReflectionOptionsSetter.set(this.$widget,this.options);if(this.value!=null)t.EditorUtils.setValue(this.$widget,this.value);if($(this.$el).data("select2"))this.$widget.changeSelect2(function(){e.$emit("input",t.EditorUtils.getValue(e.$widget))});else this.$widget.change(function(){e.$emit("input",t.EditorUtils.getValue(e.$widget))})},destroyed:function(){if(this.$widget){this.$widget.destroy();this.$widget=null}}});return true}!e()&&typeof $!=="undefined"&&$(e)})(Serenity||(Serenity={}));